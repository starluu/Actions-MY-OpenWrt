name: Docker æµ‹è¯•

on:
  workflow_dispatch:

jobs:
  alist-automation:
    runs-on: ubuntu-latest
    
    steps:
    # ========== åˆå§‹é˜¶æ®µï¼šå†…ç½‘ç©¿é€ ==========
    - name: ä½¿ç”¨ çšæœˆè¿ ç©¿é€
      run: |
        docker run -d --name natpierce \
            --restart=always \
            --privileged \
            --net=host \
            -v natpierce_data:/natpierce \
            xiyu505/natpierce:latest  

    - name: ä½¿ç”¨ cpolar ç©¿é€
      run: |
        docker run -d --name=cpola --privileged --net=host --restart=always -e AUTH_TOKEN=${{ secrets.CPOLAR_TOKEN }} kikitech/cpolar
        docker exec -i cpolar /bin/bash
        cpolar http 9200 > /dev/null &

    - name: ä½¿ç”¨ Ngrok ç©¿é€
      run: |
        docker run -d --name=ngrok --privileged --net=host --restart=always -e NGROK_AUTHTOKEN=${{ secrets.NGROK_TOKEN }} ngrok/ngrok:alpine http 9000

    # ========== éƒ¨ç½²é˜¶æ®µï¼šå®¹å™¨åˆå§‹åŒ– ==========
    - name: å¯åŠ¨ portainer å®¹å™¨
      run: |
        docker run -d --restart=always --name="portainer" -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock 6053537/portainer-ce:2.24.1-alpine
           echo "â³ ç­‰å¾…æ‰‹åŠ¨é…ç½®æµ‹è¯•é¡¹ç›®"
           echo "ğŸ‘‰ é¢„ç•™6å°æ—¶æ‰‹åŠ¨æ“ä½œæ—¶é—´"
        sleep 6h
