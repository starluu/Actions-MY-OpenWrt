name: Docker æµ‹è¯•

on:
  workflow_dispatch:

jobs:
  alist-automation:
    runs-on: ubuntu-latest
    
    steps:
    # ========== åˆå§‹é˜¶æ®µï¼šå†…ç½‘ç©¿é€ ==========
    - name: ä½¿ç”¨ cpolar ç©¿é€
      run: |
        # ä¸‹è½½ cpolar
        wget https://www.cpolar.com/static/downloads/releases/3.3.18/cpolar-stable-linux-amd64.zip
        unzip cpolar-stable-linux-amd64.zip
        
        # è®¾ç½®è®¤è¯ä»¤ç‰Œï¼ˆåœ¨ https://dashboard.cpolar.com è·å–ï¼‰
        ./cpolar authtoken ${{ secrets.CPOLAR_TOKEN }} 
        
        # å¯åŠ¨éš§é“
        ./cpolar http 6901 > /dev/null &
        ./cpolar http 9200 > /dev/null &
        
    - name: ä½¿ç”¨ Ngrok ç©¿é€
      run: |
        # ä¸‹è½½ ngrok
        wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
        tar xvzf ngrok-v3-stable-linux-amd64.tgz
        
        # è®¾ç½®è®¤è¯ä»¤ç‰Œï¼ˆåœ¨ https://dashboard.ngrok.com è·å–ï¼‰
        ./ngrok authtoken ${{ secrets.NGROK_TOKEN }}
        
        # å¯åŠ¨éš§é“
        ./ngrok http 9000 > /dev/null &
        
    # ========== éƒ¨ç½²é˜¶æ®µï¼šå®¹å™¨åˆå§‹åŒ– ==========
    - name: å¯åŠ¨ portainer å®¹å™¨
      run: |
        docker run -d --restart=always --name="portainer" -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock 6053537/portainer-ce
    
    - name: å¯åŠ¨ test å®¹å™¨
      run: |
        docker run -d \
            --name chrome \
            --shm-size=1024m \
            -p 6901:6901 \
            -e VNC_PW=password \
            -e LANG=zh_CN.UTF-8 \
            -e TZ=Asia/Shanghai \
            -u root \
            --restart always \
            kasmweb/chrome:1.17.0-rolling-daily
            echo "â³ ç­‰å¾…æ‰‹åŠ¨é…ç½®æµ‹è¯•é¡¹ç›®"
            echo "ğŸ‘‰ é¢„ç•™6å°æ—¶æ‰‹åŠ¨æ“ä½œæ—¶é—´"
         sleep 6h
